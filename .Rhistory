data <- merge(data, DestLatLon, by.x="DestCityState", by.y="unqDests", all.x=TRUE)
# Exploratory Data Analysis
library(tidyverse)
library(ggmap)
# use gdata to read in the .xls file of customer survey data
library(readxl)
data <- read_xlsx("./Satisfaction Survey(2).xlsx")
str(data)
data$OriginCity <- sapply(strsplit(data$`Orgin City`, ","), '[',1)
data$DestinationCity <- sapply(strsplit(data$`Destination City`, ","), '[',1)
unqDests <- unique(data$DestinationCity)
unqOrigins <- unique(data$OriginCity)
data$OriginCityState <- paste(data$OriginCity, ", ", data$`Origin State`, sep="")
data$DestinationCityState <- paste(data$DestinationCity, ", ", data$`Destination State`, sep=""
# Create a city state combination in the data to pass to the geocode function
data$OriginCityState <- paste(data$OriginCity, ", ", data$`Origin State`, sep="")
# Create a city state combination in the data to pass to the geocode function
data$OriginCityState <- paste(data$OriginCity, ", ", data$`Origin State`, sep="")
data$DestinationCityState <- paste(data$DestinationCity, ", ", data$`Destination State`, sep="")
# Get the unique Origin and destination cities to limit api calls to Google's geocode
unqOrigins <- unique(data$OriginCityState)
unqDests <- unique(data$DestinationCityState)
OriginLatLon <- read.csv("./OrigLatLon.csv")
DestLatLon <- read.csv("./DestLatLon.csv")
# left join the data to bring in the Origin lat and lon
data <- merge(data, OriginLatLon, by.x="OriginCityState", by.y="unqOrigins", all.x=TRUE)
# left join the data to bring in the Destination lat and lon
data <- merge(data, DestLatLon, by.x="DestCityState", by.y="unqDests", all.x=TRUE)
View(DestLatLon)
# left join the data to bring in the Destination lat and lon
data <- merge(data, DestLatLon, by.x="DestinationCityState", by.y="unqDests", all.x=TRUE)
View(data)
# Drop the indicies from the LatLon files
data = subset(data, select=-c("X.x", "X.y"))
# Drop the indicies from the LatLon files
data = subset(data, select=-c(`X.x`, `X.y`))
library(ggplot2)
library(maps)
library(rgeos)
library(maptools)
library(geosphere)
library(plyr)
install.packages("geosphere")
install.packages("geos")
library(ggplot2)
library(maps)
library(rgeos)
library(maptools)
library(geosphere)
library(plyr)
fortify.SpatialLinesDataFrame = function(model, data, ...){
ldply(model@lines, fortify)
}
# calculate routes for each row
routes = gcIntermediate(df[,c('lon1', 'lat1')], df[,c('lon2', 'lat2')], 200, breakAtDateLine = FALSE, addStartEnd = TRUE, sp=TRUE)
# fortify to dataframe
fortifiedroutes = fortify.SpatialLinesDataFrame(routes)
# get US map
usmap <- map_data("US")
View(data)
routes = gcIntermediate(data[,c('Orig_lon', 'Orig_lat')], data[,c('Dest_lon', 'Dest_lat')], 200, breakAtDateLine = FALSE, addStartEnd = TRUE, sp=TRUE)
# get US map
usmap <- map_data("United States")
# get US map
usmap <- map_data("USA")
# get US map
usmap <- map_data("usa")
# fortify to dataframe
fortifiedroutes <- fortify.SpatialLinesDataFrame(routes)
urbanareasin <- readShapePoly("ne_10m_urban_areas.shp")
urb <- c(geom_polygon(aes(long, lat, group = group),
size = 0.3,
color = "#ffffff",
fill = "#ffffff",
alpha = 1,
data = urbanareasin))
urbanareasin <- st_read("ne_10m_urban_areas.shp")
??sf::st_read
install.packages("rgdal")
library(rgdal)
urbanareasin <- readOGR("ne_10m_urban_areas.shp")
urbanareasin <- readOGR("ne_10m_urban_areas.shp")
urbanareasin <- readOGR("./ne_10m_urban_areas")
urbanareasin <- readOGR("./ne_10m_urban_areas.shp")
urbanareasin <- readOGR(dsn=path.expand("./ne_10m_urban_areas.shp"), layer = ne_10m_urban_areas)
urbanareasin <- readOGR(dsn=path.expand("./ne_10m_urban_areas"), layer = ne_10m_urban_areas)
urbanareasin <- readOGR(dsn=path.expand("./ne_10m_urban_areas.shp"), layer = "ne_10m_urban_areas")
urbanareasin <- readOGR(dsn=path.expand("./ne_10m_urban_areas"), layer = "ne_10m_urban_areas")
urbanareasin <- readOGR(dsn=path.expand("./"), layer = "ne_10m_urban_areas")
urbanareasin <- readOGR(dsn="./ne_10m_urban_areas.shp")
urbanareasin <- readOGR(dsn="./ne_10m_urban_areas.shp")
urbanareasin <- readOGR(dsn=path.expand("./"), layer = "ne_10m_urban_areas")
urbanareasin <- readOGR(dsn=path.expand("./ne_10m_urban_areas/"), layer = "ne_10m_urban_areas")
pwd
cwd
ls()
urbanareasin <- readOGR("./ne_10m_urban_areas/ne_10m_urban_areas.shp"))
urbanareasin <- readOGR("./ne_10m_urban_areas/ne_10m_urban_areas.shp")
urb <- c(geom_polygon(aes(long, lat, group = group),
size = 0.3,
color = "#ffffff",
fill = "#ffffff",
alpha = 1,
data = urbanareasin))
tapply(data, c(data$OriginCityState, data$DestinationCityState), n)
tapply(data$Satisfaction, c(data$OriginCityState, data$DestinationCityState), n)
tapply(data$Satisfaction, list(data$OriginCityState, data$DestinationCityState), n)
data %>%
group_by(OriginCityState, DestinationCityState)
data %>%
group_by(OriginCityState, DestinationCityState) %>%
summarise(
count = n()
)
dat_grp <- data %>%
group_by(OriginCityState, DestinationCityState) %>%
summarise(
count = n(Satisfaction)
)
data %>%
group_by(OriginCityState, DestinationCityState) %>%
summarise(
n = n()
)
data %>%
group_by(OriginCityState, DestinationCityState)
dat_grp <- data %>%
group_by(OriginCityState, DestinationCityState) %>%
summarise(
count = n()
)
data %>%
dplyr::group_by(OriginCityState, DestinationCityState) %>%
dplyr::summarise(
count = dplyr::n()
)
dat_grp <- data %>%
dplyr::group_by(OriginCityState, DestinationCityState) %>%
dplyr::summarise(
count = dplyr::n()
)
sum(data_grp$count)
sum(dat_grp$count)
head(dat_grp)
OriginLatLon <- read.csv("./OrigLatLon.csv")
DestLatLon <- read.csv("./DestLatLon.csv")
dat_grp <- merge(dat_grp, OriginLatLon, by.x="OriginCityState", by.y="unqOrigins", all.x=TRUE)
head(dat_grp)
dat_grp <- merge(dat_grp, DestLatLon, by.x="DestinationCityState", by.y="unqDests", all.x=TRUE)
head(dat_grp)
dat_grp = subset(dat_grp, select=-c(`X.x`, `X.y`))
head(dat_grp)
# calculate routes for each row
routes = gcIntermediate(data_grp[,c('Orig_lon', 'Orig_lat')], dat_grp[,c('Dest_lon', 'Dest_lat')], 200, breakAtDateLine = FALSE, addStartEnd = TRUE, sp=TRUE)
# calculate routes for each row
routes = gcIntermediate(dat_grp[,c('Orig_lon', 'Orig_lat')], dat_grp[,c('Dest_lon', 'Dest_lat')], 200, breakAtDateLine = FALSE, addStartEnd = TRUE, sp=TRUE)
# fortify to dataframe
fortifiedroutes <- fortify.SpatialLinesDataFrame(routes)
View(routes)
urb <- c(geom_polygon(aes(long, lat, group = group),
size = 0.3,
color = "#ffffff",
fill = "#ffffff",
alpha = 1,
data = urbanareasin))
# get US map
worldmap <- map_data("world")
rm(usmap)
View(fortifiedroutes)
routes_count = data.frame('count'=dat_grp$count, 'id'=1:nrow(dat_grp), 'Location':dat_grp$OriginCityState)
sapply(dat_grp, function(x) sum(is.na(a)))
sapply(dat_grp, function(x) sum(is.na(x)))
routes_count = data.frame('count'=dat_grp$count, 'id'=1:nrow(dat_grp), 'Location':dat_grp$OriginCityState)
routes_count <- data.frame('count'=dat_grp$count, 'id'=1:nrow(dat_grp), 'Location'=dat_grp$OriginCityState)
View(routes_count)
greatcircles <- merge(fortifiedroutes, routes_count, all.x=T, by='id')
# get US map
worldmap <- map_data("world")
c(geom_polygon(aes(long,lat,group=group), size = 0.1, colour= "#090D2A",
fill="#090D2A", alpha=0.8, data=worldmap))
wrld <- c(geom_polygon(aes(long,lat,group=group), size = 0.1, colour= "#090D2A",
fill="#090D2A", alpha=0.8, data=worldmap))
ggplot() +
wrld +
urb +
geom_line(aes(long,lat,group=id, color=Location), alpha = 0.3, size=0.01, data= greatcircles) +
theme(panel.background = element_rect(fill='#00001C',colour='#00001C'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
theme(legend.position = c(0,0.4),
legend.justification = c(0,1),
legend.background = element_rect(colour = NA, fill = NA),
legend.key = element_rect(colour = NA, fill = NA, size = 10),
legend.text = element_text(colour='white', size = 20))
ggplot() +
wrld +
urb +
geom_line(aes(long,lat,group=id, color=Location), alpha = 0.3, size=0.01, data= greatcircles) +
theme(panel.background = element_rect(fill='#00001C',colour='#00001C'), panel.grid.major = element_blank(), panel.grid.minor = element_blank())
ggplot() +
wrld +
urb +
geom_line(aes(long,lat,group=id, color=Location), alpha = 0.3, size=0.01, data= greatcircles) +
theme(panel.background = element_rect(fill='#00001C',colour='#00001C'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
theme(legend.position = "none")
ggplot() +
wrld +
urb +
geom_line(aes(long,lat,group=id, color=Location), alpha = 0.3, size=0.01, data= greatcircles) +
theme(panel.background = element_rect(fill='#00001C',colour='#00001C'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
theme(legend.position = "none",
axis.line=element_blank(),axis.text.x=element_blank(),
axis.text.y=element_blank(),axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank())
flightmap <- ggplot() +
wrld +
urb +
geom_line(aes(long,lat,group=id, color=Location), alpha = 0.3, size=0.01, data= greatcircles) +
theme(panel.background = element_rect(fill='#00001C',colour='#00001C'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
theme(legend.position = "none",
axis.line=element_blank(),axis.text.x=element_blank(),
axis.text.y=element_blank(),axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank())
ggsave("./images/flightmap.png")
# Check that the count matches the total
sum(dat_grp$count) = nrow(data)
# Check that the count matches the total
sum(dat_grp$count) == nrow(data)
library(tidyverse)
library(readxl)
# read the data file in as a dataframe
data <- read_xlsx("./data/Satisfaction Survey(2).xlsx")
# Find the amount of null values in each column
sapply(data, function(x) sum(is.na(x)))
# Find the amount of null values in each column using dplyr
data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na(.)))) %>%
transpose()
# Find the amount of null values in each column using dplyr
nulls <- data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na(.)))) %>%
transpose()
# Find the amount of null values in each column using dplyr
nulls <- data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na(.)))) %>%
transpose() %>%
data.frame(unlist())
# Find the amount of null values in each column using dplyr
nulls <- data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na(.)))) %>%
transpose()
data.frame(unlist(nulls)
)
data.frame(unlist(nulls))
nulls <- data.frame(unlist(nulls))
nulls
nulls[isna(nulls$unlist.nulls.)]
nulls[(nulls$unlist.nulls.)]
nulls[(nulls$unlist.nulls.),]
nulls[nulls$unlist.nulls. != 0,]
# Check on the nulls in the satisfaction column
data &>&
filter(is.na(Satisfaaction))
data %>%
count(Satisfaction)
# Check on the nulls in the satisfaction column
data &>&
filter(Satisfaction == NA)
# Check on the nulls in the satisfaction column
data &>&
filter(!is.na(Satisfaction))
data %>%
ilter(!is.na(Satisfaction))
data %>%
filter(!is.na(Satisfaction))
# Check on the nulls in the satisfaction column
data %>%
filter(is.na(Satisfaction))
# Check on the nulls in the satisfaction column
nullSats <- data %>%
filter(is.na(Satisfaction))
View(nulls)
View(nullSats)
data %>%
filter(is.na(`Arrival Delay in Minutes`))
nullArrivalDelay <- data %>%
filter(is.na(`Arrival Delay in Minutes`))
View(nullArrivalDelay)
nullArrivalDelay %>%
filter(`Flight cancelled` == 'Yes') %>%
sum()
data %>%
filter(!is.na(Satisfaction)) %>%
geom_histogram(mapping = aes(x=Satisfaction))
data %>%
filter(!is.na(Satisfaction)) %>%
geom_histogram(mapping = aes(x=Satisfaction))
data %>%
filter(!is.na(Satisfaction)) %>%
geom_bar(mapping = aes(x=Satisfaction))
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot() +
geom_bar(mapping = aes(x=Satisfaction))
ggplot() +
geom_boxplot(mapping = aes(x=Satisfaction))
ggplot() +
geom_bar(mapping = aes(x=Satisfaction))
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction) %>%
ggplot() +
geom_bar(mapping = aes(x=Satisfaction))
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction)
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction) %>%
ggplot() +
geom_bar(mapping = aes(x=n))
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction) %>%
ggplot() +
geom_bar(mapping = aes(x=Satisfaction, y = n))
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction) %>%
ggplot() +
geom_boxplot(mapping = aes(x=Satisfaction, y = n))
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction) %>%
ggplot() +
geom_bar(mapping = aes(x=n))
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot() +
geom_bar(mapping = aes(x=Satisfaction))
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_bar(mapping = aes(group = cut_number(Satisfaction, c)))
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_bar(mapping = aes(group = cut_number(Satisfaction, 8)))
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_bar(mapping = aes(group = cut_width(Satisfaction, .5)))
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_bar(mapping = aes(group = cut_width(Satisfaction, .5)))
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_bar(mapping = aes(group = cut_width(Satisfaction, 0.5)))
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_bar(mapping = aes(group = cut_number(Satisfaction, 8)))
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_bar(mapping = aes(group = cut_width(Satisfaction, 0.5)))
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction) %>%
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_bar(mapping = aes(group = cut_width(Satisfaction, 0.5)))
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction) %>%
ggplot(mapping = aes(x=Satisfaction, y = n)) +
geom_boxplot(mapping = aes(group = cut_width(Satisfaction, 0.5)))
data %>%
filter(!is.na(Satisfaction)) %>%
count(Satisfaction)
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot(mapping = aes(x=Satisfaction)) +
geom_bar()
data %>%
filter(!is.na(Satisfaction)) %>%
filter(Satisfaction %in% c(2.5, 3.5)) %>%
ggplot(mapping = aes(x=Satisfaction)) +
geom_bar()
data %>%
filter(!is.na(Satisfaction)) %>%
filter(Satisfaction %in% c(2.5, 3.5, 4.5)) %>%
ggplot(mapping = aes(x=Satisfaction)) +
geom_bar()
# Create a bar chart to show the counts of each Satisfaction
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot(mapping = aes(x=Satisfaction)) +
geom_bar()
nullArrivalDelay %>%
filter(`Flight cancelled` == 'Yes') %>%
summarize(`Flight cancelled` = sum())
nullArrivalDelay %>%
filter(`Flight cancelled` == 'Yes')
sum(nullArrivalDelay$`Flight cancelled` == "Yes")
sum(nullArrivalDelay$`Flight cancelled` == "No")
# Exploratory Data Analysis
library(tidyverse)
library(readxl)
# read the data file in as a dataframe
data <- read_xlsx("./data/Satisfaction Survey(2).xlsx")
# Create a bar chart to show the counts of each Satisfaction
data %>%
filter(!is.na(Satisfaction)) %>%
ggplot(mapping = aes(x=Satisfaction)) +
geom_bar()
# Find the amount of null values in each column
sapply(data, function(x) sum(is.na(x)))
# Find the amount of null values in each column using dplyr
nulls <- data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na(.)))) %>%
transpose()
nulls <- data.frame(unlist(nulls))
View(nulls)
View(nulls)
View(nulls)
nulls <- data %>%
select(everything()) %>%
summarise_all(list( ~ sum(is.na(.)))) %>%
transpose()
nulls <- data.frame(unlist(nulls))
View(nulls)
View(nulls)
View(data)
# Check on the nulls in the satisfaction column
# nothing out of the ordinary here. Will drop these rows in our learning
nullSats <- data %>%
filter(is.na(Satisfaction))
View(nulls)
View(nullSats)
nullArrivalDelay <- data %>%
filter(is.na(`Arrival Delay in Minutes`))
sum(nullArrivalDelay$`Flight cancelled` == "Yes")
# Look at only data with null Departure Delays
nullDepDelay <- data %>%
filter(is.na(`Departure Delay in Minutes`))
# Not all NA values for Arrival Delay in Minutes are cancelled, interesting
sum(nullArrivalDelay$`Flight cancelled` == "Yes")
data %>%
filter(`Flight Cancelled` == "Yes")
data %>%
filter(`Flight cancelled` == "Yes")
data %>%
filter(`Flight cancelled` == "Yes") %>%
select(c(`Flight cancelled`, `Departure Delay in Minutes`, `Arrival Delay in Minutes`))
data %>%
filter(`Flight cancelled` == "Yes") %>%
select(c(`Flight cancelled`, `Departure Delay in Minutes`, `Arrival Delay in Minutes`)) %>%
summarise_all(list( ~ sum(is.na(.)))) %>%    # lambda function
transpose()
# remove the rows with NAs in Satisfaction
data <- data[!is.na(data$Satisfaction),]
# Not all NA values for Arrival Delay in Minutes are cancelled, interesting
sum(nullArrivalDelay$`Flight cancelled` == "Yes")
unique(data$`Flight cancelled`)
data %>%
filter(`Flight cancelled` == "Yes") %>%
select(c(`Flight cancelled`, `Departure Delay in Minutes`, `Arrival Delay in Minutes`, `Flight Time in Minutes`)) %>%
summarise_all(list( ~ sum(is.na(.)))) %>%    # lambda function
transpose()
# Find the amount of null values in each column using dplyr
nulls <- data %>%
select(everything()) %>%
summarise_all(list( ~ sum(is.na(.)))) %>%    # lambda function
transpose()
nulls <- data.frame(unlist(nulls))
View(nulls)
data %>%
filter(`Flight cancelled` == "Yes") %>%
select(c(`Flight cancelled`, `Departure Delay in Minutes`, `Arrival Delay in Minutes`, `Flight Time in Minutes`)) %>%
summarise_all(list( ~ sum(is.na(.)))) %>%    # lambda function
transpose()
data %>%
filter(`Flight cancelled` == "Yes") %>%
select(c(`Flight cancelled`, `Departure Delay in Minutes`, `Arrival Delay in Minutes`, `Flight time in minutes`)) %>%
summarise_all(list( ~ sum(is.na(.)))) %>%    # lambda function
transpose()
2401 - 2345
data %>%
filter(`Flight cancelled` == "No") %>%
select(c(`Flight cancelled`, `Departure Delay in Minutes`, `Arrival Delay in Minutes`, `Flight time in minutes`)) %>%
summarise_all(list( ~ sum(is.na(.)))) %>%    # lambda function
transpose()
data %>%
filter(`Flight cancelled` == "No") %>%
select(c(`Flight cancelled`, `Departure Delay in Minutes`, `Arrival Delay in Minutes`, `Flight time in minutes`)) %>%
summarise_all(list( ~ sum(is.na(.)))) %>%    # lambda function
transpose()
data %>%
filter(`Flight cancelled` == "No") %>%
select(c(`Flight cancelled`, `Departure Delay in Minutes`, `Arrival Delay in Minutes`, `Flight time in minutes`))
# get the amount of NA values that are not related to Flights being cancelled
data %>%
filter(`Flight cancelled` == "No") %>%
filter(is.na(`Arrival Delay in Minutes`))
filter(is.na(`Arrival Delay in Minutes`))
# get the amount of NA values that are not related to Flights being cancelled
View(data %>%
filter(`Flight cancelled` == "No") %>%
filter(is.na(`Arrival Delay in Minutes`)))
