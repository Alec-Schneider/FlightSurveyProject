# use gdata to read in the .xls file of customer survey data
library(gdata)
data <- read.xls("./Satisfaction Survey(2).xlsx")
library(data.table)
data <- read.xls("./Satisfaction Survey(2).xlsx")
data2 <- fread("./Satisfaction Survey(2).xlsx", stringsAsFactors = FALSE, header = TRUE, data.table = FALSE)
data2 <- fread(file = "./Satisfaction Survey(2).xlsx", stringsAsFactors = FALSE, header = TRUE, data.table = FALSE)
data2 <- fread(file = "./Satisfaction Survey(2).xlsx", stringsAsFactors = FALSE, header = TRUE, data.table = FALSE, na.strings = "NA")
data2 <- fread(file = "./Satisfaction Survey(2).xlsx", stringsAsFactors = FALSE, data.table = FALSE, na.strings = "NA")
data2 <- fread(file = "./Satisfaction Survey(2).xlsx", stringsAsFactors = FALSE, data.table = FALSE)
View(data2)
View(data2)
data2 <- fread(file = " sed 's/\\0//g' ./Satisfaction Survey(2).xlsx", stringsAsFactors = FALSE, data.table = FALSE)
data2 <- fread(" sed 's/\\0//g' ./Satisfaction Survey(2).xlsx", stringsAsFactors = FALSE, data.table = FALSE)
data2 <- fread("sed 's/\\0//g' ./Satisfaction Survey(2).xlsx", stringsAsFactors = FALSE, data.table = FALSE)
# use gdata to read in the .xls file of customer survey data
library(gdata)
data <- read.xls("./Satisfaction Survey(2).xlsx")
library(gdata)
perl = "C:\\Perl64\\bin\\perl.exe"
data <- read.xls("./Satisfaction Survey(2).xlsx", perl=perl)
library(readxl)
data2 <- read_xlsx("./Satisfaction Survey(2).xlsx")
data <- read_xlsx("./Satisfaction Survey(2).xlsx")
str(data)
summary(data)
head(data)
rm(data2)
tail(data)
View(data)
gregexpr(",", "Madison, Wisconsin")
sapply(strsplit(data$`Orgin City`[1:5], ","))
strsplit(data$`Orgin City`[1:5], ",")
strsplit(data$`Orgin City`[1:5], ",")[1]
sapply(strsplit(data$`Orgin City`[1:5], ","), '[',1)
data$OriginCity <- sapply(strsplit(data$`Orgin City`[1:5], ","), '[',1)
data$OriginCity <- sapply(strsplit(data$`Orgin City`, ","), '[',1)
data$DestinationCity <- sapply(strsplit(data$`Destination City`, ","), '[',1)
View(data)
is.na(data)
sum(is.na(data))
sapply(data, function(x), sum(is.na(x)))
sapply(data, function(x) sum(is.na(x)))
# Exploratory Data Analysis
library(tidyverse)
data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na(,))))
data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na())))
data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na(.))))
data %>%
select(everything()) %>%
summarise_all(funs(sum(is.na(.)))) %>%
transpose()
??geocode
library(ggmap)
paste(data$OriginCity, ", ", data$`Origin State`)
geocode(paste(data$OriginCity, ",", data$`Origin State`))
paste(data$OriginCity, ",", data$`Origin State`)
paste(data$OriginCity, ", ", data$`Origin State`, sep="")
geocode(paste(data$OriginCity, ",", data$`Origin State`))
?register_google
register_google(key="AIzaSyDxtdj2XlQl5jctuvMPCUO2eUQPncQxO4Y", write=TRUE)
geocode("Dallas/Fort Worth, Texas")
OriginLatLon <- geocode(paste(data$OriginCity, ", ", data$`Origin State`, sep=""))
class(paste(data$OriginCity, ", ", data$`Origin State`, sep=""))
type(paste(data$OriginCity, ", ", data$`Origin State`, sep=""))
is.list(paste(data$OriginCity, ", ", data$`Origin State`, sep=""))
is.vector(paste(data$OriginCity, ", ", data$`Origin State`, sep=""))
?unique
unqOrigins <- paste(data$OriginCity, ", ", data$`Origin State`, sep="")
unqOrigins <- unique(paste(data$OriginCity, ", ", data$`Origin State`, sep=""))
unqDests <- unique(paste(data$DestinationCity, ", ", data$`Destination State`, sep=""))
OriginLatLon <- geocode(unqOrigins)
tail(OriginLatLon)
sapply(OriginLatLon, function(x) sum(is.na(x)))
DestLatLon <- gecode(unqDests)
OriginLatLon[is.na(OriginLatLon$lon),]
geocode("Guam")
guam <- geocode("Guam")
OriginLatLon$lon <- ifelse(is.na(OriginLatLon$lon), guam$lon, OriginLatLon$lon)
OriginLatLon$lat <- ifelse(is.na(OriginLatLon$lat), guam$lat, OriginLatLon$lat)
sapply(OriginLatLon, function(x) sum(is.na(x)))
colnames(OriginLatLon)
colnames(OriginLatLon) <- c("Orig_lon", "Orig_lat")
View(OriginLatLon)
DestLatLon <- gecode(unqDests)
DestLatLon <- geocode(unqDests)
sapply(DestLatLon, function(x) sum(is.na(x)))
DestLatLon$lon <- ifelse(is.na(DestLatLon$lon), guam$lon, DestLatLon$lon)
DestLatLon$lat <- ifelse(is.na(DestLatLon$lat), guam$lat, DestLatLon$lat)
sapply(DestLatLon, function(x) sum(is.na(x)))
write.csv(OrigLatLon, file="./OrigLatLon.csv")
write.csv(OriginLatLon, file="./OrigLatLon.csv")
write.csv(DestLatLon, file="./DestLatLon.csv")
colnames(DestLatLon) <- c("Dest_lon", "Dest_lat")
View(DestLatLon)
write.csv(DestLatLon, file="./DestLatLon.csv")
?MAPPLY
?mapply
?map
?cbind
cbind(OriginLatLon, unqOrigins)
OriginLatLon <- cbind(OriginLatLon, unqOrigins)
DestLatLon <- cbind(DestLatLon, unqDests)
# write the lat and lons of the locations so we do not need to make API calls again
write.csv(OriginLatLon, file="./OrigLatLon.csv")
write.csv(DestLatLon, file="./DestLatLon.csv")
# Get the unique Origins and Destinations to limit API calls to geocode
data$OriginCityState <- paste(data$OriginCity, ", ", data$`Origin State`, sep="")
data$DestCityState <- paste(data$DestinationCity, ", ", data$`Destination State`, sep="")
?merge
dim(merge(data, OriginLatLon, by=c(OriginCityState, unqOrigins), all.x=TRUE))
dim(merge(data, OriginLatLon, by=c(OriginCityState, unqOrigins), all.x=TRUE))
dim(merge(data, OriginLatLon, by=c("OriginCityState", "unqOrigins"), all.x=TRUE))
dim(merge(data, OriginLatLon, by.x="OriginCityState", by.y="unqOrigins", all.x=TRUE))
head(merge(data, OriginLatLon, by.x="OriginCityState", by.y="unqOrigins", all.x=TRUE))[,20:34]
# left join the data to bring in the Origin lat and lon
data <- merge(data, OriginLatLon, by.x="OriginCityState", by.y="unqOrigins", all.x=TRUE)
# left join the data to bring in the Destination lat and lon
data <- merge(data, DestLatLon, by.x="DestinationCityState", by.y="unqDests", all.x=TRUE)
# left join the data to bring in the Destination lat and lon
data <- merge(data, DestLatLon, by.x="DestCityState", by.y="unqDests", all.x=TRUE)
